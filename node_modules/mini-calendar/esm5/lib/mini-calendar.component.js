/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ChangeDetectorRef } from '@angular/core';
import * as moment_ from 'moment';
/** @type {?} */
var moment = moment_;
var MiniCalendarComponent = /** @class */ (function () {
    function MiniCalendarComponent(ref) {
        this.ref = ref;
        this.mainColor = '#03a9f4';
        this.secondaryColor = '#ff5';
        this.selectedDateChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    MiniCalendarComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.month = moment(this.selectedDate).clone();
        /** @type {?} */
        var start = moment(this.selectedDate).clone();
        start.date(1);
        this._removeTime(start.day(0));
        this._buildMonth(start, this.month);
        this.select(moment(this.selectedDate).clone());
        this.ref.detectChanges();
    };
    /**
     * @param {?} day
     * @return {?}
     */
    MiniCalendarComponent.prototype.select = /**
     * @param {?} day
     * @return {?}
     */
    function (day) {
        this.selectedDate = day.date;
        this.selectedDateChange.emit(this.selectedDate);
    };
    /**
     * @param {?} day
     * @return {?}
     */
    MiniCalendarComponent.prototype.getBgColor = /**
     * @param {?} day
     * @return {?}
     */
    function (day) {
        return {
            'background-color': this.isInWeek(day) ? this.secondaryColor : day.isToday ? this.mainColor : '',
            'opacity': day.isToday ? '.5' : '1'
        };
    };
    /**
     * @param {?} day
     * @return {?}
     */
    MiniCalendarComponent.prototype.isInWeek = /**
     * @param {?} day
     * @return {?}
     */
    function (day) {
        if (this.selectedDate && this.selectedDate.isSame) {
            if (this.showWeek) {
                /** @type {?} */
                var tempMoment = this.selectedDate.clone();
                tempMoment.isoWeekday(0);
                /** @type {?} */
                var otherTempMoment = this.selectedDate.clone();
                otherTempMoment.isoWeekday(7);
                otherTempMoment.isAfter(day.date);
                return tempMoment.isSame(day.date) || (tempMoment.isBefore(day.date) && otherTempMoment.isAfter(day.date));
            }
            else {
                return this.selectedDate.isSame(day.date);
            }
        }
        return false;
    };
    /**
     * @return {?}
     */
    MiniCalendarComponent.prototype.next = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var next = this.month.clone();
        this._removeTime(next.month(next.month() + 1).date(1));
        this.month.month(this.month.month() + 1);
        this._buildMonth(next, this.month);
    };
    /**
     * @return {?}
     */
    MiniCalendarComponent.prototype.previous = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var previous = this.month.clone();
        this._removeTime(previous.month(previous.month() - 1).date(1));
        this.month.month(this.month.month() - 1);
        this._buildMonth(previous, this.month);
    };
    /**
     * @param {?} date
     * @return {?}
     */
    MiniCalendarComponent.prototype._removeTime = /**
     * @param {?} date
     * @return {?}
     */
    function (date) {
        return date.day(0).hour(0).minute(0).second(0).millisecond(0);
    };
    /**
     * @param {?} date
     * @param {?} month
     * @return {?}
     */
    MiniCalendarComponent.prototype._buildWeek = /**
     * @param {?} date
     * @param {?} month
     * @return {?}
     */
    function (date, month) {
        /** @type {?} */
        var days = [];
        for (var i = 0; i < 7; i++) {
            days.push({
                name: date.format('dd').substring(0, 1),
                numb: date.date(),
                isCurrentMonth: date.month() === month.month(),
                isToday: date.isSame(new Date(), 'day'),
                date: date
            });
            date = date.clone();
            date.add(1, 'd');
        }
        return days;
    };
    /**
     * @param {?} start
     * @param {?} month
     * @return {?}
     */
    MiniCalendarComponent.prototype._buildMonth = /**
     * @param {?} start
     * @param {?} month
     * @return {?}
     */
    function (start, month) {
        this.weeks = [];
        /** @type {?} */
        var date = start.clone();
        /** @type {?} */
        var done = false;
        /** @type {?} */
        var monthIndex = date.month();
        /** @type {?} */
        var count = 0;
        while (!done) {
            this.weeks.push({ days: this._buildWeek(date.clone(), month) });
            date.add(1, 'w');
            done = count++ > 2 && monthIndex !== date.month();
            monthIndex = date.month();
        }
    };
    MiniCalendarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'mini-calendar',
                    template: "<div class=\"mini-calendar-component\">\n\t<div class=\"header layout-row layout-align-center-center\" [ngStyle]=\"{'background-color': mainColor}\">\n\t\t<i class=\"fas fa-chevron-left\" (click)=\"previous()\"></i>\n\t\t<span>{{month.format(\"MMM YYYY\")}}</span>\n\t\t<i class=\"fas fa-chevron-right\" (click)=\"next()\"></i>\n\t</div>\n\t<div class=\"week\" *ngFor=\"let week of weeks\">\n\t\t<span class=\"day\" [ngStyle]=\"getBgColor(day)\" [ngClass]=\"{ 'different-month': !day.isCurrentMonth }\"\n\t\t\t(click)=\"select(day)\" *ngFor=\"let day of week.days\">{{day.numb}}</span>\n\t</div>\n</div>\n",
                    styles: [".border-box{box-sizing:border-box;-moz-box-sizing:border-box}.mini-calendar-component{float:left;display:block;box-sizing:border-box;-moz-box-sizing:border-box;background:#fff;width:190px;border:1px solid #ccc}.mini-calendar-component>div.header{display:flex;justify-content:space-between;width:100%;height:40px;color:#fff;border-bottom:1px solid #ccc}.mini-calendar-component>div.header>*{height:40px;line-height:40px!important;display:inline-block;vertical-align:middle}.mini-calendar-component>div.header>i{float:left;width:30px;font-weight:700;position:relative;box-sizing:border-box;-moz-box-sizing:border-box;padding:0;cursor:pointer}.mini-calendar-component>div.header>span{float:left;font-weight:700;text-transform:uppercase;box-sizing:border-box;-moz-box-sizing:border-box;text-align:center;color:inherit}.mini-calendar-component>div.week{float:left;width:100%}.mini-calendar-component>div.week:first-child{border-top:none}.mini-calendar-component>div.week>span.day{float:left;width:14.28571429%;box-sizing:border-box;-moz-box-sizing:border-box;font-size:.75em;text-align:center;height:30px;line-height:30px!important;display:inline-block;vertical-align:middle;background:#fff;cursor:pointer;color:#000}.mini-calendar-component>div.week>span.day:first-child{border-left:none}.mini-calendar-component>div.week>span.day.different-month{color:silver}"]
                }] }
    ];
    /** @nocollapse */
    MiniCalendarComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    MiniCalendarComponent.propDecorators = {
        mainColor: [{ type: Input }],
        secondaryColor: [{ type: Input }],
        showWeek: [{ type: Input }],
        selectedDate: [{ type: Input }],
        selectedDateChange: [{ type: Output }]
    };
    return MiniCalendarComponent;
}());
export { MiniCalendarComponent };
if (false) {
    /** @type {?} */
    MiniCalendarComponent.prototype.mainColor;
    /** @type {?} */
    MiniCalendarComponent.prototype.secondaryColor;
    /** @type {?} */
    MiniCalendarComponent.prototype.showWeek;
    /** @type {?} */
    MiniCalendarComponent.prototype.selectedDate;
    /** @type {?} */
    MiniCalendarComponent.prototype.selectedDateChange;
    /** @type {?} */
    MiniCalendarComponent.prototype.month;
    /** @type {?} */
    MiniCalendarComponent.prototype.weeks;
    /** @type {?} */
    MiniCalendarComponent.prototype.ref;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluaS1jYWxlbmRhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9taW5pLWNhbGVuZGFyLyIsInNvdXJjZXMiOlsibGliL21pbmktY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xHLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDOztJQUM1QixNQUFNLEdBQUcsT0FBTztBQUV0QjtJQWVFLCtCQUFvQixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQVRqQyxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLG1CQUFjLEdBQUcsTUFBTSxDQUFDO1FBR3ZCLHVCQUFrQixHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7SUFLTCxDQUFDOzs7O0lBRTlDLHdDQUFROzs7SUFBUjtRQUNFLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7WUFFekMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxFQUFFO1FBQy9DLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUMz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LEtBQUssRUFBRTs7WUFBRSxLQUFLLEdBQUcsQ0FBQztRQUN0RCxPQUFPLENBQUMsSUFBSSxFQUFFO1lBQ1osSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2hFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLElBQUksR0FBRyxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksVUFBVSxLQUFLLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNsRCxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQzs7Z0JBckdGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsZUFBZTtvQkFDekIseW1CQUEyQzs7aUJBRTVDOzs7O2dCQVJ3RCxpQkFBaUI7Ozs0QkFVdkUsS0FBSztpQ0FDTCxLQUFLOzJCQUNMLEtBQUs7K0JBQ0wsS0FBSztxQ0FDTCxNQUFNOztJQTZGVCw0QkFBQztDQUFBLEFBdkdELElBdUdDO1NBbEdZLHFCQUFxQjs7O0lBQ2hDLDBDQUErQjs7SUFDL0IsK0NBQWlDOztJQUNqQyx5Q0FBMkI7O0lBQzNCLDZDQUEyQjs7SUFDM0IsbURBQWtEOztJQUVsRCxzQ0FBYTs7SUFDYixzQ0FBYTs7SUFFRCxvQ0FBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIE91dHB1dCwgRXZlbnRFbWl0dGVyLCBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0ICogYXMgbW9tZW50XyBmcm9tICdtb21lbnQnO1xuY29uc3QgbW9tZW50ID0gbW9tZW50XztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbWluaS1jYWxlbmRhcicsXG4gIHRlbXBsYXRlVXJsOiAnbWluaS1jYWxlbmRhci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWydtaW5pLWNhbGVuZGFyLmNvbXBvbmVudC5sZXNzJ11cbn0pXG5leHBvcnQgY2xhc3MgTWluaUNhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgbWFpbkNvbG9yID0gJyMwM2E5ZjQnO1xuICBASW5wdXQoKSBzZWNvbmRhcnlDb2xvciA9ICcjZmY1JztcbiAgQElucHV0KCkgc2hvd1dlZWs6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHNlbGVjdGVkRGF0ZTogYW55O1xuICBAT3V0cHV0KCkgc2VsZWN0ZWREYXRlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHB1YmxpYyBtb250aDtcbiAgd2Vla3M6IGFueVtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge31cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLm1vbnRoID0gbW9tZW50KHRoaXMuc2VsZWN0ZWREYXRlKS5jbG9uZSgpO1xuXG4gICAgY29uc3Qgc3RhcnQgPSBtb21lbnQodGhpcy5zZWxlY3RlZERhdGUpLmNsb25lKCk7XG4gICAgc3RhcnQuZGF0ZSgxKTtcbiAgICB0aGlzLl9yZW1vdmVUaW1lKHN0YXJ0LmRheSgwKSk7XG5cbiAgICB0aGlzLl9idWlsZE1vbnRoKHN0YXJ0LCB0aGlzLm1vbnRoKTtcbiAgICB0aGlzLnNlbGVjdChtb21lbnQodGhpcy5zZWxlY3RlZERhdGUpLmNsb25lKCkpO1xuICAgIHRoaXMucmVmLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHB1YmxpYyBzZWxlY3QoZGF5KSB7XG4gICAgdGhpcy5zZWxlY3RlZERhdGUgPSBkYXkuZGF0ZTtcbiAgICB0aGlzLnNlbGVjdGVkRGF0ZUNoYW5nZS5lbWl0KHRoaXMuc2VsZWN0ZWREYXRlKTtcbiAgfVxuXG4gIGdldEJnQ29sb3IoZGF5KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdiYWNrZ3JvdW5kLWNvbG9yJzogdGhpcy5pc0luV2VlayhkYXkpID8gdGhpcy5zZWNvbmRhcnlDb2xvciA6IGRheS5pc1RvZGF5ID8gdGhpcy5tYWluQ29sb3IgOiAnJyxcbiAgICAgICdvcGFjaXR5JzogZGF5LmlzVG9kYXkgPyAnLjUnIDogJzEnXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyBpc0luV2VlayhkYXkpIHtcbiAgICBpZiAodGhpcy5zZWxlY3RlZERhdGUgJiYgdGhpcy5zZWxlY3RlZERhdGUuaXNTYW1lKSB7XG4gICAgICBpZiAodGhpcy5zaG93V2Vlaykge1xuICAgICAgICBjb25zdCB0ZW1wTW9tZW50ID0gdGhpcy5zZWxlY3RlZERhdGUuY2xvbmUoKTtcbiAgICAgICAgdGVtcE1vbWVudC5pc29XZWVrZGF5KDApO1xuICAgICAgICBjb25zdCBvdGhlclRlbXBNb21lbnQgPSB0aGlzLnNlbGVjdGVkRGF0ZS5jbG9uZSgpO1xuICAgICAgICBvdGhlclRlbXBNb21lbnQuaXNvV2Vla2RheSg3KTtcbiAgICAgICAgb3RoZXJUZW1wTW9tZW50LmlzQWZ0ZXIoZGF5LmRhdGUpO1xuICAgICAgICByZXR1cm4gdGVtcE1vbWVudC5pc1NhbWUoZGF5LmRhdGUpIHx8ICh0ZW1wTW9tZW50LmlzQmVmb3JlKGRheS5kYXRlKSAmJiBvdGhlclRlbXBNb21lbnQuaXNBZnRlcihkYXkuZGF0ZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0ZWREYXRlLmlzU2FtZShkYXkuZGF0ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHB1YmxpYyBuZXh0KCkge1xuICAgIGNvbnN0IG5leHQgPSB0aGlzLm1vbnRoLmNsb25lKCk7XG4gICAgdGhpcy5fcmVtb3ZlVGltZShuZXh0Lm1vbnRoKG5leHQubW9udGgoKSArIDEpLmRhdGUoMSkpO1xuICAgIHRoaXMubW9udGgubW9udGgodGhpcy5tb250aC5tb250aCgpICsgMSk7XG4gICAgdGhpcy5fYnVpbGRNb250aChuZXh0LCB0aGlzLm1vbnRoKTtcbiAgfVxuXG4gIHB1YmxpYyBwcmV2aW91cygpIHtcbiAgICBjb25zdCBwcmV2aW91cyA9IHRoaXMubW9udGguY2xvbmUoKTtcbiAgICB0aGlzLl9yZW1vdmVUaW1lKHByZXZpb3VzLm1vbnRoKHByZXZpb3VzLm1vbnRoKCkgLSAxKS5kYXRlKDEpKTtcbiAgICB0aGlzLm1vbnRoLm1vbnRoKHRoaXMubW9udGgubW9udGgoKSAtIDEpO1xuICAgIHRoaXMuX2J1aWxkTW9udGgocHJldmlvdXMsIHRoaXMubW9udGgpO1xuICB9XG5cbiAgcHVibGljIF9yZW1vdmVUaW1lKGRhdGUpIHtcbiAgICByZXR1cm4gZGF0ZS5kYXkoMCkuaG91cigwKS5taW51dGUoMCkuc2Vjb25kKDApLm1pbGxpc2Vjb25kKDApO1xuICB9XG5cbiAgcHVibGljIF9idWlsZFdlZWsoZGF0ZSwgbW9udGgpIHtcbiAgICBjb25zdCBkYXlzID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCA3OyBpKyspIHtcbiAgICAgIGRheXMucHVzaCh7XG4gICAgICAgIG5hbWU6IGRhdGUuZm9ybWF0KCdkZCcpLnN1YnN0cmluZygwLCAxKSxcbiAgICAgICAgbnVtYjogZGF0ZS5kYXRlKCksXG4gICAgICAgIGlzQ3VycmVudE1vbnRoOiBkYXRlLm1vbnRoKCkgPT09IG1vbnRoLm1vbnRoKCksXG4gICAgICAgIGlzVG9kYXk6IGRhdGUuaXNTYW1lKG5ldyBEYXRlKCksICdkYXknKSxcbiAgICAgICAgZGF0ZTogZGF0ZVxuICAgICAgfSk7XG4gICAgICBkYXRlID0gZGF0ZS5jbG9uZSgpO1xuICAgICAgZGF0ZS5hZGQoMSwgJ2QnKTtcbiAgICB9XG4gICAgcmV0dXJuIGRheXM7XG4gIH1cblxuICBwdWJsaWMgX2J1aWxkTW9udGgoc3RhcnQsIG1vbnRoKSB7XG4gICAgdGhpcy53ZWVrcyA9IFtdO1xuICAgIGNvbnN0IGRhdGUgPSBzdGFydC5jbG9uZSgpO1xuICAgIGxldCBkb25lID0gZmFsc2UsIG1vbnRoSW5kZXggPSBkYXRlLm1vbnRoKCksIGNvdW50ID0gMDtcbiAgICB3aGlsZSAoIWRvbmUpIHtcbiAgICAgIHRoaXMud2Vla3MucHVzaCh7IGRheXM6IHRoaXMuX2J1aWxkV2VlayhkYXRlLmNsb25lKCksIG1vbnRoKSB9KTtcbiAgICAgIGRhdGUuYWRkKDEsICd3Jyk7XG4gICAgICBkb25lID0gY291bnQrKyA+IDIgJiYgbW9udGhJbmRleCAhPT0gZGF0ZS5tb250aCgpO1xuICAgICAgbW9udGhJbmRleCA9IGRhdGUubW9udGgoKTtcbiAgICB9XG4gIH1cblxufVxuIl19