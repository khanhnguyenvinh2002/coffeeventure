/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ChangeDetectorRef } from '@angular/core';
import * as moment_ from 'moment';
/** @type {?} */
const moment = moment_;
export class MiniCalendarComponent {
    /**
     * @param {?} ref
     */
    constructor(ref) {
        this.ref = ref;
        this.mainColor = '#03a9f4';
        this.secondaryColor = '#ff5';
        this.selectedDateChange = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.month = moment(this.selectedDate).clone();
        /** @type {?} */
        const start = moment(this.selectedDate).clone();
        start.date(1);
        this._removeTime(start.day(0));
        this._buildMonth(start, this.month);
        this.select(moment(this.selectedDate).clone());
        this.ref.detectChanges();
    }
    /**
     * @param {?} day
     * @return {?}
     */
    select(day) {
        this.selectedDate = day.date;
        this.selectedDateChange.emit(this.selectedDate);
    }
    /**
     * @param {?} day
     * @return {?}
     */
    getBgColor(day) {
        return {
            'background-color': this.isInWeek(day) ? this.secondaryColor : day.isToday ? this.mainColor : '',
            'opacity': day.isToday ? '.5' : '1'
        };
    }
    /**
     * @param {?} day
     * @return {?}
     */
    isInWeek(day) {
        if (this.selectedDate && this.selectedDate.isSame) {
            if (this.showWeek) {
                /** @type {?} */
                const tempMoment = this.selectedDate.clone();
                tempMoment.isoWeekday(0);
                /** @type {?} */
                const otherTempMoment = this.selectedDate.clone();
                otherTempMoment.isoWeekday(7);
                otherTempMoment.isAfter(day.date);
                return tempMoment.isSame(day.date) || (tempMoment.isBefore(day.date) && otherTempMoment.isAfter(day.date));
            }
            else {
                return this.selectedDate.isSame(day.date);
            }
        }
        return false;
    }
    /**
     * @return {?}
     */
    next() {
        /** @type {?} */
        const next = this.month.clone();
        this._removeTime(next.month(next.month() + 1).date(1));
        this.month.month(this.month.month() + 1);
        this._buildMonth(next, this.month);
    }
    /**
     * @return {?}
     */
    previous() {
        /** @type {?} */
        const previous = this.month.clone();
        this._removeTime(previous.month(previous.month() - 1).date(1));
        this.month.month(this.month.month() - 1);
        this._buildMonth(previous, this.month);
    }
    /**
     * @param {?} date
     * @return {?}
     */
    _removeTime(date) {
        return date.day(0).hour(0).minute(0).second(0).millisecond(0);
    }
    /**
     * @param {?} date
     * @param {?} month
     * @return {?}
     */
    _buildWeek(date, month) {
        /** @type {?} */
        const days = [];
        for (let i = 0; i < 7; i++) {
            days.push({
                name: date.format('dd').substring(0, 1),
                numb: date.date(),
                isCurrentMonth: date.month() === month.month(),
                isToday: date.isSame(new Date(), 'day'),
                date: date
            });
            date = date.clone();
            date.add(1, 'd');
        }
        return days;
    }
    /**
     * @param {?} start
     * @param {?} month
     * @return {?}
     */
    _buildMonth(start, month) {
        this.weeks = [];
        /** @type {?} */
        const date = start.clone();
        /** @type {?} */
        let done = false;
        /** @type {?} */
        let monthIndex = date.month();
        /** @type {?} */
        let count = 0;
        while (!done) {
            this.weeks.push({ days: this._buildWeek(date.clone(), month) });
            date.add(1, 'w');
            done = count++ > 2 && monthIndex !== date.month();
            monthIndex = date.month();
        }
    }
}
MiniCalendarComponent.decorators = [
    { type: Component, args: [{
                selector: 'mini-calendar',
                template: "<div class=\"mini-calendar-component\">\n\t<div class=\"header layout-row layout-align-center-center\" [ngStyle]=\"{'background-color': mainColor}\">\n\t\t<i class=\"fas fa-chevron-left\" (click)=\"previous()\"></i>\n\t\t<span>{{month.format(\"MMM YYYY\")}}</span>\n\t\t<i class=\"fas fa-chevron-right\" (click)=\"next()\"></i>\n\t</div>\n\t<div class=\"week\" *ngFor=\"let week of weeks\">\n\t\t<span class=\"day\" [ngStyle]=\"getBgColor(day)\" [ngClass]=\"{ 'different-month': !day.isCurrentMonth }\"\n\t\t\t(click)=\"select(day)\" *ngFor=\"let day of week.days\">{{day.numb}}</span>\n\t</div>\n</div>\n",
                styles: [".border-box{box-sizing:border-box;-moz-box-sizing:border-box}.mini-calendar-component{float:left;display:block;box-sizing:border-box;-moz-box-sizing:border-box;background:#fff;width:190px;border:1px solid #ccc}.mini-calendar-component>div.header{display:flex;justify-content:space-between;width:100%;height:40px;color:#fff;border-bottom:1px solid #ccc}.mini-calendar-component>div.header>*{height:40px;line-height:40px!important;display:inline-block;vertical-align:middle}.mini-calendar-component>div.header>i{float:left;width:30px;font-weight:700;position:relative;box-sizing:border-box;-moz-box-sizing:border-box;padding:0;cursor:pointer}.mini-calendar-component>div.header>span{float:left;font-weight:700;text-transform:uppercase;box-sizing:border-box;-moz-box-sizing:border-box;text-align:center;color:inherit}.mini-calendar-component>div.week{float:left;width:100%}.mini-calendar-component>div.week:first-child{border-top:none}.mini-calendar-component>div.week>span.day{float:left;width:14.28571429%;box-sizing:border-box;-moz-box-sizing:border-box;font-size:.75em;text-align:center;height:30px;line-height:30px!important;display:inline-block;vertical-align:middle;background:#fff;cursor:pointer;color:#000}.mini-calendar-component>div.week>span.day:first-child{border-left:none}.mini-calendar-component>div.week>span.day.different-month{color:silver}"]
            }] }
];
/** @nocollapse */
MiniCalendarComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
MiniCalendarComponent.propDecorators = {
    mainColor: [{ type: Input }],
    secondaryColor: [{ type: Input }],
    showWeek: [{ type: Input }],
    selectedDate: [{ type: Input }],
    selectedDateChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    MiniCalendarComponent.prototype.mainColor;
    /** @type {?} */
    MiniCalendarComponent.prototype.secondaryColor;
    /** @type {?} */
    MiniCalendarComponent.prototype.showWeek;
    /** @type {?} */
    MiniCalendarComponent.prototype.selectedDate;
    /** @type {?} */
    MiniCalendarComponent.prototype.selectedDateChange;
    /** @type {?} */
    MiniCalendarComponent.prototype.month;
    /** @type {?} */
    MiniCalendarComponent.prototype.weeks;
    /** @type {?} */
    MiniCalendarComponent.prototype.ref;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWluaS1jYWxlbmRhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9taW5pLWNhbGVuZGFyLyIsInNvdXJjZXMiOlsibGliL21pbmktY2FsZW5kYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2xHLE9BQU8sS0FBSyxPQUFPLE1BQU0sUUFBUSxDQUFDOztNQUM1QixNQUFNLEdBQUcsT0FBTztBQU90QixNQUFNLE9BQU8scUJBQXFCOzs7O0lBVWhDLFlBQW9CLEdBQXNCO1FBQXRCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBVGpDLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFDdEIsbUJBQWMsR0FBRyxNQUFNLENBQUM7UUFHdkIsdUJBQWtCLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztJQUtMLENBQUM7Ozs7SUFFOUMsUUFBUTtRQUNOLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7Y0FFekMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsS0FBSyxFQUFFO1FBQy9DLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVB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LENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDaEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDakIsSUFBSSxHQUFHLEtBQUssRUFBRSxHQUFHLENBQUMsSUFBSSxVQUFVLEtBQUssSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2xELFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDM0I7SUFDSCxDQUFDOzs7WUFyR0YsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxlQUFlO2dCQUN6Qix5bUJBQTJDOzthQUU1Qzs7OztZQVJ3RCxpQkFBaUI7Ozt3QkFVdkUsS0FBSzs2QkFDTCxLQUFLO3VCQUNMLEtBQUs7MkJBQ0wsS0FBSztpQ0FDTCxNQUFNOzs7O0lBSlAsMENBQStCOztJQUMvQiwrQ0FBaUM7O0lBQ2pDLHlDQUEyQjs7SUFDM0IsNkNBQTJCOztJQUMzQixtREFBa0Q7O0lBRWxELHNDQUFhOztJQUNiLHNDQUFhOztJQUVELG9DQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIENoYW5nZURldGVjdG9yUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgKiBhcyBtb21lbnRfIGZyb20gJ21vbWVudCc7XG5jb25zdCBtb21lbnQgPSBtb21lbnRfO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtaW5pLWNhbGVuZGFyJyxcbiAgdGVtcGxhdGVVcmw6ICdtaW5pLWNhbGVuZGFyLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ21pbmktY2FsZW5kYXIuY29tcG9uZW50Lmxlc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBNaW5pQ2FsZW5kYXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBtYWluQ29sb3IgPSAnIzAzYTlmNCc7XG4gIEBJbnB1dCgpIHNlY29uZGFyeUNvbG9yID0gJyNmZjUnO1xuICBASW5wdXQoKSBzaG93V2VlazogYm9vbGVhbjtcbiAgQElucHV0KCkgc2VsZWN0ZWREYXRlOiBhbnk7XG4gIEBPdXRwdXQoKSBzZWxlY3RlZERhdGVDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgcHVibGljIG1vbnRoO1xuICB3ZWVrczogYW55W107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWY6IENoYW5nZURldGVjdG9yUmVmKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMubW9udGggPSBtb21lbnQodGhpcy5zZWxlY3RlZERhdGUpLmNsb25lKCk7XG5cbiAgICBjb25zdCBzdGFydCA9IG1vbWVudCh0aGlzLnNlbGVjdGVkRGF0ZSkuY2xvbmUoKTtcbiAgICBzdGFydC5kYXRlKDEpO1xuICAgIHRoaXMuX3JlbW92ZVRpbWUoc3RhcnQuZGF5KDApKTtcblxuICAgIHRoaXMuX2J1aWxkTW9udGgoc3RhcnQsIHRoaXMubW9udGgpO1xuICAgIHRoaXMuc2VsZWN0KG1vbWVudCh0aGlzLnNlbGVjdGVkRGF0ZSkuY2xvbmUoKSk7XG4gICAgdGhpcy5yZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgcHVibGljIHNlbGVjdChkYXkpIHtcbiAgICB0aGlzLnNlbGVjdGVkRGF0ZSA9IGRheS5kYXRlO1xuICAgIHRoaXMuc2VsZWN0ZWREYXRlQ2hhbmdlLmVtaXQodGhpcy5zZWxlY3RlZERhdGUpO1xuICB9XG5cbiAgZ2V0QmdDb2xvcihkYXkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgJ2JhY2tncm91bmQtY29sb3InOiB0aGlzLmlzSW5XZWVrKGRheSkgPyB0aGlzLnNlY29uZGFyeUNvbG9yIDogZGF5LmlzVG9kYXkgPyB0aGlzLm1haW5Db2xvciA6ICcnLFxuICAgICAgJ29wYWNpdHknOiBkYXkuaXNUb2RheSA/ICcuNScgOiAnMSdcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGlzSW5XZWVrKGRheSkge1xuICAgIGlmICh0aGlzLnNlbGVjdGVkRGF0ZSAmJiB0aGlzLnNlbGVjdGVkRGF0ZS5pc1NhbWUpIHtcbiAgICAgIGlmICh0aGlzLnNob3dXZWVrKSB7XG4gICAgICAgIGNvbnN0IHRlbXBNb21lbnQgPSB0aGlzLnNlbGVjdGVkRGF0ZS5jbG9uZSgpO1xuICAgICAgICB0ZW1wTW9tZW50Lmlzb1dlZWtkYXkoMCk7XG4gICAgICAgIGNvbnN0IG90aGVyVGVtcE1vbWVudCA9IHRoaXMuc2VsZWN0ZWREYXRlLmNsb25lKCk7XG4gICAgICAgIG90aGVyVGVtcE1vbWVudC5pc29XZWVrZGF5KDcpO1xuICAgICAgICBvdGhlclRlbXBNb21lbnQuaXNBZnRlcihkYXkuZGF0ZSk7XG4gICAgICAgIHJldHVybiB0ZW1wTW9tZW50LmlzU2FtZShkYXkuZGF0ZSkgfHwgKHRlbXBNb21lbnQuaXNCZWZvcmUoZGF5LmRhdGUpICYmIG90aGVyVGVtcE1vbWVudC5pc0FmdGVyKGRheS5kYXRlKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3RlZERhdGUuaXNTYW1lKGRheS5kYXRlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHVibGljIG5leHQoKSB7XG4gICAgY29uc3QgbmV4dCA9IHRoaXMubW9udGguY2xvbmUoKTtcbiAgICB0aGlzLl9yZW1vdmVUaW1lKG5leHQubW9udGgobmV4dC5tb250aCgpICsgMSkuZGF0ZSgxKSk7XG4gICAgdGhpcy5tb250aC5tb250aCh0aGlzLm1vbnRoLm1vbnRoKCkgKyAxKTtcbiAgICB0aGlzLl9idWlsZE1vbnRoKG5leHQsIHRoaXMubW9udGgpO1xuICB9XG5cbiAgcHVibGljIHByZXZpb3VzKCkge1xuICAgIGNvbnN0IHByZXZpb3VzID0gdGhpcy5tb250aC5jbG9uZSgpO1xuICAgIHRoaXMuX3JlbW92ZVRpbWUocHJldmlvdXMubW9udGgocHJldmlvdXMubW9udGgoKSAtIDEpLmRhdGUoMSkpO1xuICAgIHRoaXMubW9udGgubW9udGgodGhpcy5tb250aC5tb250aCgpIC0gMSk7XG4gICAgdGhpcy5fYnVpbGRNb250aChwcmV2aW91cywgdGhpcy5tb250aCk7XG4gIH1cblxuICBwdWJsaWMgX3JlbW92ZVRpbWUoZGF0ZSkge1xuICAgIHJldHVybiBkYXRlLmRheSgwKS5ob3VyKDApLm1pbnV0ZSgwKS5zZWNvbmQoMCkubWlsbGlzZWNvbmQoMCk7XG4gIH1cblxuICBwdWJsaWMgX2J1aWxkV2VlayhkYXRlLCBtb250aCkge1xuICAgIGNvbnN0IGRheXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDc7IGkrKykge1xuICAgICAgZGF5cy5wdXNoKHtcbiAgICAgICAgbmFtZTogZGF0ZS5mb3JtYXQoJ2RkJykuc3Vic3RyaW5nKDAsIDEpLFxuICAgICAgICBudW1iOiBkYXRlLmRhdGUoKSxcbiAgICAgICAgaXNDdXJyZW50TW9udGg6IGRhdGUubW9udGgoKSA9PT0gbW9udGgubW9udGgoKSxcbiAgICAgICAgaXNUb2RheTogZGF0ZS5pc1NhbWUobmV3IERhdGUoKSwgJ2RheScpLFxuICAgICAgICBkYXRlOiBkYXRlXG4gICAgICB9KTtcbiAgICAgIGRhdGUgPSBkYXRlLmNsb25lKCk7XG4gICAgICBkYXRlLmFkZCgxLCAnZCcpO1xuICAgIH1cbiAgICByZXR1cm4gZGF5cztcbiAgfVxuXG4gIHB1YmxpYyBfYnVpbGRNb250aChzdGFydCwgbW9udGgpIHtcbiAgICB0aGlzLndlZWtzID0gW107XG4gICAgY29uc3QgZGF0ZSA9IHN0YXJ0LmNsb25lKCk7XG4gICAgbGV0IGRvbmUgPSBmYWxzZSwgbW9udGhJbmRleCA9IGRhdGUubW9udGgoKSwgY291bnQgPSAwO1xuICAgIHdoaWxlICghZG9uZSkge1xuICAgICAgdGhpcy53ZWVrcy5wdXNoKHsgZGF5czogdGhpcy5fYnVpbGRXZWVrKGRhdGUuY2xvbmUoKSwgbW9udGgpIH0pO1xuICAgICAgZGF0ZS5hZGQoMSwgJ3cnKTtcbiAgICAgIGRvbmUgPSBjb3VudCsrID4gMiAmJiBtb250aEluZGV4ICE9PSBkYXRlLm1vbnRoKCk7XG4gICAgICBtb250aEluZGV4ID0gZGF0ZS5tb250aCgpO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=